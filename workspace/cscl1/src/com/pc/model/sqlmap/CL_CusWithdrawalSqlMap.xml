<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_CusWithdrawal">
<resultMap type="com.pc.model.CL_CusWithdrawal" id="CL_CusWithdrawalMap">
	<result column="fid" property="fid"/>
	<result column="fapplicant" property="fapplicant"/>
	<result column="fapply_time" property="fapply_time"/>
	<result column="fcustomer" property="fcustomer"/>
	<result column="fapply_money" property="fapply_money"/>
	<result column="fluck_money" property="fluck_money"/>
	<result column="fcus_balance" property="fcus_balance"/>
	<result column="fapply_reason" property="fapply_reason"/>
	<result column="faudit_time" property="faudit_time"/>
	<result column="fauditor" property="fauditor"/>
	<result column="fis_pass" property="fis_pass"/>
	<result column="fgrant_time" property="fgrant_time"/>
	<result column="fgrantor" property="fgrantor"/>
	<result column="freject_time" property="freject_time"/>
	<result column="frejecter" property="frejecter"/>
</resultMap>

	<sql id="columns">
		<![CDATA[
			cw.fid,cw.fapplicant,cw.fapply_time,cw.fcustomer,cw.fapply_money,cw.fluck_money,cw.fcus_balance,cw.fapply_reason,cw.faudit_time,cw.fauditor,cw.fis_pass,cw.fgrant_time,
			cw.fgrantor,cw.freject_time,cw.frejecter,cu.fname as customer,ur1.vmi_user_name as applicant,ur2.vmi_user_name as auditor,ur3.vmi_user_name as grantor,ur4.vmi_user_name as rejecter
		]]>
	</sql>
	
	<insert id="insert"  useGeneratedKeys="true" keyProperty="fid">
		insert into cl_cusWithdrawal(
			fapplicant,
			fapply_time,
			fcustomer,
			fapply_money,
			fluck_money,
			fcus_balance,
			fapply_reason,
			faudit_time,
			fauditor,
			fgrant_time,
			fgrantor,
			freject_time,
			frejecter
		) values(
			#{fapplicant,jdbcType=INTEGER},
			#{fapply_time,jdbcType=TIMESTAMP},
			#{fcustomer,jdbcType=INTEGER},
			#{fapply_money,jdbcType=DECIMAL},
			#{fluck_money,jdbcType=DECIMAL},
			#{fcus_balance,jdbcType=DECIMAL},
			#{fapply_reason,jdbcType=VARCHAR},
			#{faudit_time,jdbcType=TIMESTAMP},
			#{fauditor,jdbcType=INTEGER},
			#{fgrant_time,jdbcType=TIMESTAMP},
			#{fgrantor,jdbcType=INTEGER},
			#{freject_time,jdbcType=TIMESTAMP},
			#{frejecter,jdbcType=INTEGER}
		)
	</insert>

	<update id="update">
		update from cl_cusWithdrawal set
			fapplicant=#{fapplicant,jdbcType=INTEGER},
			fapply_time=#{fapply_time,jdbcType=TIMESTAMP},
			fcustomer=#{fcustomer,jdbcType=INTEGER},
			fapply_money=#{fapply_money,jdbcType=DECIMAL},
			fluck_money=#{fluck_money,jdbcType=DECIMAL},
			fcus_balance=#{fcus_balance,jdbcType=DECIMAL},
			fapply_reason=#{fapply_reason,jdbcType=VARCHAR},
			faudit_time=#{faudit_time,jdbcType=TIMESTAMP},
			fauditor=#{fauditor,jdbcType=INTEGER},
			fgrant_time=#{fgrant_time,jdbcType=TIMESTAMP},
			fgrantor=#{fgrantor,jdbcType=INTEGER},
			freject_time=#{freject_time,jdbcType=TIMESTAMP},
			frejecter=#{frejecter,jdbcType=INTEGER}
		where
			 fid=#{fid,jdbcType=INTEGER}
	</update>

	<delete id="delete">
		delete from cl_cusWithdrawal where fid=#{fid}
	</delete>

	<select id="getById" resultMap="CL_CusWithdrawalMap">
		select <include refid="columns"/> from cl_cusWithdrawal cw
		left join cl_user_customer cu on cu.fuser_role_id=cw.fcustomer
		left join cl_user_role ur1 on ur1.id=cw.fapplicant
		left join cl_user_role ur2 on ur2.id=cw.fauditor
		left join cl_user_role ur3 on ur3.id=cw.fgrantor
		left join cl_user_role ur4 on ur4.id=cw.frejecter
	</select>

	<sql id="findWhere">
		<where>
			<if test="@Ognl@isNotEmpty(fcustomer)">
				and cw.fcustomer=#{fcustomer}
			</if>
			<if test="@Ognl@isNotEmpty(start_apply_time)">
				and cw.fapply_time>#{start_apply_time}
			</if>
			<if test="@Ognl@isNotEmpty(end_apply_time)">
				<![CDATA[ and cw.fapply_time<#{end_apply_time} ]]>
			</if>
		</where>
	</sql>
	
	<select id="findPage" resultMap="CL_CusWithdrawalMap">
		select <include refid="columns"/> from cl_cusWithdrawal cw
		left join cl_user_customer cu on cu.fuser_role_id=cw.fcustomer
		left join cl_user_role ur1 on ur1.id=cw.fapplicant
		left join cl_user_role ur2 on ur2.id=cw.fauditor
		left join cl_user_role ur3 on ur3.id=cw.fgrantor
		left join cl_user_role ur4 on ur4.id=cw.frejecter
		<include refid="findWhere"/>
		order by fapply_time desc
	</select>
	
	<select id="findPageCount" resultMap="CL_CusWithdrawalMap">
		select count(fid) from cl_cusWithdrawal cw
		left join cl_user_customer cu on cu.fuser_role_id=cw.fcustomer
		left join cl_user_role ur1 on ur1.id=cw.fapplicant
		left join cl_user_role ur2 on ur2.id=cw.fauditor
		left join cl_user_role ur3 on ur3.id=cw.fgrantor
		left join cl_user_role ur4 on ur4.id=cw.frejecter
		<include refid="findWhere"/>
	</select>
	

</mapper>


