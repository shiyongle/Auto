<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_Bank">

	<resultMap id="CLBankMap" type="com.pc.model.CL_Bank">
		<result property="fid" column="fid" />
		<result property="fbankName" column="fbankName" />
		<result property="ftel" column="ftel" />
		<result property="fcardpaytype" column="fcardpaytype" />
		<result property="fcardNumber" column="fcardNumber" />
		<result property="fuserId" column="fuserId" />
		<result property="fcreateTime" column="fcreateTime" />
		<result property="fdefault" column="fdefault" />
		<result property="feffect" column="feffect" />
		<result property="fcard" column="fcard" />
		<result property="fname" column="fname" />
		<result property="number" column="number" />
		<result property="fdel" column="fdel" />
		<result property="ftype" column="ftype" />
		<result property="fdelfcl_ban_info__id" column="fdelfcl_ban_info__id" />
		<result property="fcreditCardCvn" column="fcreditCardCvn" />
		<result property="fcreditCardYear" column="fcreditCardYear" />
		<result property="fcreditCardMonth" column="fcreditCardMonth" />
		<result property="fbankpayTime" column="fbankpayTime" />
		
	</resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[fid ,fbankName ,ftel, fcardpaytype,fcardNumber,fuserId,fcreateTime,fdefault,feffect,fdel,fcard,ftype,fname,number,fdelfcl_ban_info__id,fcreditCardCvn,fcreditCardYear,fcreditCardMonth,fbankpayTime]]>
	</sql>




	<insert id="insert" useGeneratedKeys="true" keyProperty="fid">
    <![CDATA[
        INSERT INTO cl_bank (
        	fid ,fbankName ,ftel, fcardpaytype,fcardNumber,fuserId,fcreateTime,fdefault,feffect,fcard,fname,number,fdel,fdelfcl_ban_info__id,fcreditCardCvn,fcreditCardYear,fcreditCardMonth,ftype,fbankpayTime
        )VALUES(
        	#{fid, jdbcType=INTEGER} ,
        	#{fbankName, jdbcType=VARCHAR} ,
        	#{ftel, jdbcType=VARCHAR} ,
        	#{fcardpaytype, jdbcType=VARCHAR} ,
        	#{fcardNumber, jdbcType=VARCHAR} ,
        	#{fuserId, jdbcType=INTEGER} ,
        	#{fcreateTime, jdbcType=TIMESTAMP} ,
        	#{fdefault, jdbcType=INTEGER} ,
        	#{feffect, jdbcType=INTEGER} ,
        	#{fcard, jdbcType=VARCHAR} ,
        	#{fname, jdbcType=VARCHAR} ,
        	#{number, jdbcType=VARCHAR} ,
        	#{fdel, jdbcType=INTEGER},
        	
        	#{fdelfcl_ban_info__id, jdbcType=INTEGER},
        	#{fcreditCardCvn, jdbcType=VARCHAR},
        	#{fcreditCardYear, jdbcType=VARCHAR},
        	#{fcreditCardMonth, jdbcType=VARCHAR},
        	#{ftype, jdbcType=INTEGER},
        	#{fbankpayTime, jdbcType=TIMESTAMP} 
        )
    ]]>
	</insert>

	<update id="update">
    <![CDATA[
        UPDATE cl_bank SET
	        fbankName=#{fbankName, jdbcType=VARCHAR} ,
	        ftel=#{ftel, jdbcType=VARCHAR} ,
	        fcardpaytype=#{fcardpaytype, jdbcType=VARCHAR} ,
	        fcardNumber=#{fcardNumber, jdbcType=VARCHAR} ,
	        fuserId= #{fuserId, jdbcType=INTEGER} ,
	        fcreateTime=#{fcreateTime, jdbcType=TIMESTAMP} ,
	        fdefault=#{fdefault, jdbcType=INTEGER} ,
	        feffect=#{feffect, jdbcType=INTEGER} ,
	        fcard=#{fcard, jdbcType=VARCHAR} ,
	        fname=#{fname, jdbcType=VARCHAR} ,
	        number=#{number, jdbcType=VARCHAR} ,
	        fdel=#{fdel, jdbcType=INTEGER},
	        fdelfcl_ban_info__id=#{fdelfcl_ban_info__id, jdbcType=INTEGER},
	        fcreditCardCvn=#{fcreditCardCvn, jdbcType=VARCHAR} ,
	        fcreditCardYear=#{fcreditCardYear, jdbcType=VARCHAR} ,
	        fcreditCardMonth=#{fcreditCardMonth, jdbcType=VARCHAR},
	        ftype=#{ftype, jdbcType=INTEGER},
	        fbankpayTime=#{fbankpayTime, jdbcType=TIMESTAMP}

        WHERE 
	        fid = #{fid, jdbcType=INTEGER} 
    ]]>
	</update>


	<update id="updateByStatus">
    <![CDATA[
        UPDATE cl_bank SET
	         fdefault=#{fdefault, jdbcType=INTEGER} ,
	        feffect=#{feffect, jdbcType=INTEGER},
	        number=#{number, jdbcType=VARCHAR}
        WHERE 
	        fid = #{fid, jdbcType=INTEGER}  AND   fuserId = #{fuserId, jdbcType=INTEGER} 
    ]]>
	</update>


	<update id="updateByFdel">
    <![CDATA[
        UPDATE cl_bank SET
	        fdel=#{fdel,jdbcType=INTEGER}
        WHERE 
	        fid = #{fid, jdbcType=INTEGER}  AND   fuserId = #{fuserId, jdbcType=INTEGER} 
    ]]>
	</update>


	<delete id="delete">
    <![CDATA[
        DELETE FROM cl_bank WHERE  fid = #{fid} and fuserId=#{fuserId}
    ]]>
	</delete>

	<select id="getById" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
	    <![CDATA[
	        FROM cl_bank WHERE  fid = #{fid}   
	    ]]>
	</select>



	<select id="getByIdAndFcreator" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
	    <![CDATA[
	        FROM cl_bank WHERE  fid = #{fid}   and fuserId=#{fuserId}
	    ]]>
	</select>

	<select id="getByUserIdAndFcardNumber" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
	    <![CDATA[
	        FROM cl_bank WHERE  fcardNumber =#{fcardNumber}   and fuserId=#{fuserId}
	    ]]>
	</select>

	<select id="getByUserIdAndFcardNumberAndV" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
	    <![CDATA[
	        FROM cl_bank WHERE  fcardNumber =#{fcardNumber}   and fuserId=#{fuserId} and feffect=1
	    ]]>
	</select>
	<sql id="findWhere">
		<where>
			<if test="@Ognl@isNotEmpty(fid)">
				AND fid = #{fid}
			</if>
			<if test="@Ognl@isNotEmpty(fuserId)">
				AND fuserId = #{fuserId}
			</if>
			<if test="@Ognl@isNotEmpty(feffect)">
				AND feffect = #{feffect}
			</if>
			<if test="@Ognl@isNotEmpty(fdel)">
				AND fdel = #{fdel}
			</if>

		</where>
	</sql>

	<!-- 求满足条件的记录数 -->
	<select id="findPageCount" resultType="long">
		SELECT count(*) FROM cl_bank
		<include refid="findWhere" />
	</select>

	<!-- 分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页 因为分页查询将传 #offset#,#pageSize#,#lastRows# 
		三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现 -->
	<select id="findPage" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
		FROM cl_bank
		<include refid="findWhere" />
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>

	</select>

	<!-- 查询记录树 -->
	<select id="find" resultMap="CLBankMap">
		SELECT
		b.fid ,b.fbankName ,b.ftel, b.fcardpaytype,b.fcardNumber,b.fuserId,b.fcreateTime,b.fdefault,
		b.feffect,b.fdel,b.fcard,b.ftype,b.fname,b.number,b.fdelfcl_ban_info__id,b.fcreditCardCvn,
		b.fcreditCardYear,b.fcreditCardMonth,b.fbankpayTime,bi.ficon
		FROM cl_bank b left join cl_bank_info bi on b.fdelfcl_ban_info__id = bi.fid
		<where>
			<if test="@Ognl@isNotEmpty(fid)">
				AND b.fid = #{fid}
			</if>
			<if test="@Ognl@isNotEmpty(fuserId)">
				AND b.fuserId = #{fuserId}
			</if>
			<if test="@Ognl@isNotEmpty(feffect)">
				AND b.feffect = #{feffect}
			</if>
			<if test="@Ognl@isNotEmpty(fdel)">
				AND b.fdel = #{fdel}
			</if>
		</where>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
		<if test="@Ognl@isNotEmpty(limit)">
			Limit ${limit}
		</if>
	</select>


	<!-- 获取银行卡列表 -->
	<select id="getBankList" resultType="java.util.Map">
		SELECT cl_bank.fid bankId,cl_bank.fbankName
		bankName,cl_bank_info.ficon bankImage,cl_bank.fcardNumber
		carNumber,feffect,cl_bank.ftel ,cl_bank_info.ftype
	    <![CDATA[
	        FROM cl_bank left join cl_bank_info on cl_bank.fdelfcl_ban_info__id=cl_bank_info.fid
	         WHERE cl_bank.fuserId=#{fuserId} and fdel=0  
	         
	    ]]>
		<if test="@Ognl@isNotEmpty(feffect)">
			and feffect= ${feffect}
		</if>
	</select>

	<!-- 获取银行卡 -->
	<select id="getBankInfo" resultMap="CLBankMap">
		SELECT
		<include refid="columns" />
	    <![CDATA[
	        FROM cl_bank 
	         WHERE fuserId=#{fuserId} and fid=#{fid} and feffect=#{feffect}
	         
	    ]]>
	</select>



	<!-- 解除用户银行卡绑定 -->
	<update id="removeUserBank">
    <![CDATA[
        UPDATE cl_bank SET
	        fdel=1
        WHERE 
	        fid in (#{fids})
	        AND fuserId = #{fuserId}
	         
    ]]>
	</update>


</mapper>

