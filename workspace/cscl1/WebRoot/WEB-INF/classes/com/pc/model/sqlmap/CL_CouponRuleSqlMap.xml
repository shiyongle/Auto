<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_CouponRule">

    <resultMap id="CLCouponRuleMap" type="com.pc.model.CL_CouponRule">
        <result property="id" column="id"/>
        <result property="dollars" column="dollars"/>
        <result property="compareDollars" column="compare_dollars"/>
        <result property="consumption" column="consumption"/>
        <result property="isEffective" column="is_effective"/>
        <result property="createTime" column="create_time"/>
        <result property="creator" column="creator"/>
    </resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[
	    clp.id,clp.dollars,clp.compare_dollars,clp.consumption,clp.is_effective,clp.create_time,clp.creator,clu.vmi_user_name as vminame
	    ]]>
	</sql>
	
    <insert id="insert" >
    <![CDATA[
        INSERT INTO cl_couponrule (
        	id,dollars,compare_dollars,consumption,is_effective,create_time,creator
        )VALUES(
        	#{id, jdbcType=INTEGER} ,
        	#{dollars, jdbcType=DECIMAL} ,
        	#{compareDollars, jdbcType=DECIMAL},
        	#{consumption, jdbcType=DECIMAL} ,
        	#{isEffective, jdbcType=INTEGER} ,
        	#{createTime, jdbcType=TIMESTAMP}  ,
        	#{creator,jdbcType=INTEGER}
        )
    ]]>
    </insert>

    <update id="update" >
    <![CDATA[
        UPDATE cl_couponrule SET
	        dollars = #{dollars, jdbcType=DECIMAL} ,
	        compare_dollars = #{compareDollars, jdbcType=DECIMAL} ,
	        consumption = #{consumption, jdbcType=DECIMAL} ,
	        is_effective = #{isEffective, jdbcType=INTEGER} ,
	        create_time = #{createTime, jdbcType=TIMESTAMP},
	        creator=#{creator,jdbcType=INTEGER}
        WHERE 
	        id = #{id,jdbcType=INTEGER} 
    ]]>
    </update>
 
   <update id="updateById" >
    <![CDATA[
        UPDATE cl_couponrule SET
	        dollars = #{dollars, jdbcType=DECIMAL} ,
	        compare_dollars = #{compareDollars, jdbcType=DECIMAL} ,
	        consumption = #{consumption, jdbcType=DECIMAL} 
        WHERE 
	        id = #{id,jdbcType=INTEGER} 
    ]]>
    </update>
    
    
    <delete id="delete">
    <![CDATA[
        DELETE FROM cl_couponrule WHERE  id = #{id} 
    ]]>
    </delete>
     
    <select id="getById" resultMap="CLCouponRuleMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_couponrule clp
	        left join cl_user_role clu  on clu.id=clp.creator
        WHERE    clp.id = #{id} 
	    ]]>
    </select>
  
 
     
    <sql id="findWhere">
	    <where>
	        <if test="@Ognl@isNotEmpty(dollars)">
			    AND clp.dollars = #{dollars}
			</if>
			<if test="@Ognl@isNotEmpty(compareDollars)">
			    AND clp.compare_dollars = #{compareDollars}
			</if>
			<if test="@Ognl@isNotEmpty(isEffective) and isEffective!=-1">
			    AND clp.is_effective =#{isEffective}
			</if>
	    </where>
	</sql>
    
    <!-- 求满足条件的记录数 --> 
   	<select id="findPageCount" resultType="long">
        SELECT count(*) FROM cl_couponrule clp
          left join cl_user_role clu  on clu.id=clp.creator
        <include refid="findWhere"/>
    </select>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <select id="findPage" resultMap="CLCouponRuleMap">
    	SELECT <include refid="columns"/> FROM cl_couponrule clp
    	  left join cl_user_role clu  on clu.id=clp.creator
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>

	<!-- 查询记录树 -->
	<select id="find" resultMap="CLCouponRuleMap">
	    SELECT <include refid="columns"/> FROM cl_couponrule clp
    	  left join cl_user_role clu  on clu.id=clp.creator
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>
    
    
</mapper>

