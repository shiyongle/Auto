<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_FinanceReceipt">
    <resultMap id="CL_FinanceReceiptMap" type="com.pc.model.CL_FinanceReceipt">
        <result property="fid" column="fid"/>
        <result property="fuserId" column="fuser_id"/>
        <result property="fcreatorId" column="fcreator_id"/>
        <result property="fcreateTime" column="fcreate_time"/>
        <result property="famount" column="famount"/>
        <result property="fpaymentMethod" column="fpayment_method"/>
        <result property="fremainAmount" column="fremain_amount"/>
        <result property="fremark" column="fremark"/>
    </resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[
        fr.fid,fr.fuser_id,fr.fcreator_id,fr.fcreate_time,fr.famount,
        fr.fpayment_method,fr.fremain_amount,fr.fremark,
        user1.vmi_user_name fusername,user2.vmi_user_name fcreatorname
	    ]]>
	</sql>
	
	
    <insert id="insert" useGeneratedKeys="true" keyProperty="fid"  >
    <![CDATA[
        INSERT INTO cl_finance_receipt (
	        fid  ,
	        fuser_id ,
	        fcreator_id ,
	        fcreate_time ,
	        famount ,
	        fpayment_method,
	        fremain_amount,
	        fremark
        ) VALUES (
        	#{fid, jdbcType=INTEGER} ,
        	#{fuserId, jdbcType=INTEGER} ,
        	#{fcreatorId, jdbcType=INTEGER} ,
        	#{fcreateTime, jdbcType=TIMESTAMP} ,
        	#{famount, jdbcType=DECIMAL} ,
        	#{fpaymentMethod, jdbcType=INTEGER} ,
        	#{fremainAmount, jdbcType=DECIMAL} ,
        	#{fremark, jdbcType=VARCHAR}
        )
    ]]>
    </insert>

    <update id="update" >
    <![CDATA[
    	UPDATE cl_finance_receipt SET
        	fremain_amount=#{fremainAmount, jdbcType=DECIMAL}
        WHERE 
	        fid = #{fid} 
    ]]>
    </update>

    <delete id="delete">
    <![CDATA[
        DELETE FROM cl_finance_receipt WHERE
        fid = #{id} 
    ]]>
    </delete>
    
    <select id="getById" resultMap="CL_FinanceReceiptMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	    	FROM cl_finance_receipt fr 
	    	LEFT JOIN cl_user_role user1 ON (fr.fuser_id=user1.id) 
	    	LEFT JOIN cl_user_role user2 ON (fr.fcreator_id=user2.id)
	        WHERE 
		        fr.fid = #{id} 
	    ]]>
    </select>

	<sql id="findWhere">
	    <where>
			<if test="@Ognl@isNotEmpty(fuserId)">
			    AND fr.fuser_id = #{fuserId}
			</if>
			<if test="@Ognl@isNotEmpty(fusername)">
			    AND user1.vmi_user_name LIKE CONCAT('%',#{fusername},'%')
			</if>
			<if test="@Ognl@isNotEmpty(receivablesTimeBegin)">
		   		AND fr.fcreate_time >= #{receivablesTimeBegin}
		   	</if>
		   	<if test="@Ognl@isNotEmpty(receivablesTimeEnd)">
		   		AND fr.fcreate_time &lt; #{receivablesTimeEnd}
		   	</if>
	    </where>
	</sql>
	 
    <select id="findPageCount" resultType="long">
        SELECT count(*) FROM cl_finance_receipt fr 
	    LEFT JOIN cl_user_role user1 ON (fr.fuser_id=user1.id) 
	    LEFT JOIN cl_user_role user2 ON (fr.fcreator_id=user2.id)
        <include refid="findWhere"/>    
    </select>
    
    <select id="findPage" resultMap="CL_FinanceReceiptMap">
    	SELECT <include refid="columns"/> FROM cl_finance_receipt fr 
	    LEFT JOIN cl_user_role user1 ON (fr.fuser_id=user1.id) 
	    LEFT JOIN cl_user_role user2 ON (fr.fcreator_id=user2.id)
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>
	
	<select id="find" resultMap="CL_FinanceReceiptMap">
	    SELECT <include refid="columns"/> 
	    FROM cl_finance_receipt fr 
	    LEFT JOIN cl_user_role user1 ON (fr.fuser_id=user1.id) 
	    LEFT JOIN cl_user_role user2 ON (fr.fcreator_id=user2.id)
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>
	
</mapper>

