<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="CL_UserBalance">
    
    	<resultMap type="com.pc.model.CL_UserBalance" id="CLUserBalanceMap">
    		<result property="fid" column="fid"/>
    		<result property="fuser_role_id" column="fuser_role_id"/>
    		 <result property="fuser_name" column="fuser_name"/> 
    		<result property="ftype" column="ftype"/>
    		<result property="foperate_money" column="foperate_money"/>
    		<result property="foperator" column="foperator"/>
    		<result property="foperate_time" column="foperate_time"/>
    		<result property="fauditor" column="fauditor"/>
    		<result property="faudit_time" column="faudit_time"/>
    		<result property="fis_pass_identify" column="fis_pass_identify"/>
    		<result property="fremark" column="fremark"/>
    		<result property="foperate_type" column="foperate_type"/>
    		<result property="money" column="money"/>
    	</resultMap>
    	
    	<!-- ifnull(car.driverName,cus.fname) as uname, -->
    	
    	<sql id="column">
    		<![CDATA[
    			ub.fid,ub.fuser_role_id,ub.fuser_name,ub.ftype,ub.foperate_money,ub.foperator,ur1.vmi_user_name as operator,ub.foperate_time,ub.fauditor,ur2.vmi_user_name as auditor,ub.faudit_time,ub.fis_pass_identify,ub.fremark,ub.foperate_type,ub.money
    		]]>
    	</sql>
    	
    	<!-- 新增记录未认证0，认证1 -->
    	<insert id="insert" >
    		insert into cl_user_balance(
    			fuser_role_id,
    			fuser_name,
    			ftype,
    			foperate_money,
    			foperator,
    			foperate_time,
    		 	fauditor,
    			faudit_time,
    			fis_pass_identify,
    			fremark,
    			foperate_type,
    			money
    		) values(
    			#{fuser_role_id,jdbcType=INTEGER},
    			#{fuser_name,jdbcType=VARCHAR},
    			#{ftype,jdbcType=INTEGER},
    			#{foperate_money,jdbcType=DECIMAL},
    			#{foperator,jdbcType=INTEGER},
    			#{foperate_time,jdbcType=TIMESTAMP},
    	 		#{fauditor,jdbcType=INTEGER},
    			#{faudit_time,jdbcType=TIMESTAMP},
    			#{fis_pass_identify,jdbcType=INTEGER},
    			#{fremark,jdbcType=VARCHAR},
    			#{foperate_type,jdbcType=INTEGER},
    			#{money,jdbcType=DECIMAL}
    		)
    	</insert>
    
    	<delete id="delete">
    		delete from cl_user_balance where fid = #{fid}
    	</delete>
    	
    	<!-- 认证 -->
    	<update id="update">
    		update cl_user_balance set
    		fauditor = #{fauditor,jdbcType=INTEGER},
    		faudit_time = #{faudit_time,jdbcType=TIMESTAMP},
    		fis_pass_identify = #{fis_pass_identify,jdbcType=INTEGER},
    		money = #{money,jdbcType=INTEGER}
    		where fid = #{fid}
    	</update> 
    	
    	
    	<select id="getById" resultMap="CLUserBalanceMap">
    		select * from cl_user_balance where fid = #{fid}
    	</select>
    	
    	<sql id="findWhere">
    		<where>
    			<if test="@Ognl@isNotEmpty(fuser_name)">
    				and fuser_name like concat('%',#{fuser_name},'%')
    			</if>
    			<if test="@Ognl@isNotEmpty(ftype)">
    				and ftype = #{ftype}
    			</if>
    		</where>
    	</sql>
    	
    	<select id="findPageCount" resultType="long">
    		select count(fid) from cl_user_balance 
    		<include refid="findWhere"/>
    		
    	</select>
    	
    	<select id="findPage" resultMap="CLUserBalanceMap">
    		select <include refid="column"/> from cl_user_balance ub
    	<!-- 	left join cl_car car on ub.fuser_role_id = car.user_role_id and ub.ftype=2
    		left join cl_user_customer cus on ub.fuser_role_id = cus.fuser_role_id and ub.ftype=1 -->
    		left join cl_user_role ur1 on ub.foperator = ur1.id
    		left join cl_user_role ur2 on ub.fauditor = ur2.id
    		<include refid="findWhere"/>
    		order by foperate_time desc
    	</select>
    
    
    
    </mapper>