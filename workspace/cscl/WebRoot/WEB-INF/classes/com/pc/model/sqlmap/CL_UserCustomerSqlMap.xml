<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_UserCustomer">

    <resultMap id="CL_UserCustomerMap" type="com.pc.model.CL_UserCustomer">
        <result property="fid" column="fid"/>
        <result property="fnumber" column="fnumber"/>
        <result property="fname" column="fname"/>
        <result property="ftype" column="ftype"/>
        <result property="fregion" column="fregion"/>
        <result property="fuserRoleId" column="fuser_role_id"/>
        <result property="fsalesManId" column="fsales_man_id"/>
        <result property="fsalesMan" column="fsales_man"/>
        <result property="fsalesManDept" column="fsales_man_dept"/>
        <result property="fsettleCycle" column="fsettle_cycle"/>
        <result property="fattention" column="fattention"/>
        <result property="fcreateTime" column="fcreate_time"/>
        <result property="fcreator" column="fcreator"/>
        <result property="faudittime" column="faudit_time"/>        
        <result property="fsimplename" column="fsimple_name"/>        
    </resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[
        fid ,fnumber,fname,ftype,fregion,fuser_role_id,fsales_man_id,fsales_man,fsales_man_dept,fsettle_cycle,fattention,fcreate_time,faudit_time,fsimple_name
	    ]]>
	</sql>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns2">
	    <![CDATA[
        uc.fid,uc.fnumber,uc.fname,uc.ftype,uc.fregion,uc.fuser_role_id,uc.fsales_man_id,uc.fsales_man,uc.fsales_man_dept,uc.fsettle_cycle,uc.fattention,uc.fcreate_time,uc.faudit_time,uc.fsimple_name,ur.vmi_user_name userName,ur.vmi_user_phone userPhone
	    ]]>
	</sql>
	
    <insert id="insert" >
    <![CDATA[
        INSERT INTO cl_user_customer(
			fid,
			fnumber,
			fname,
			ftype,
			fregion,
			fuser_role_id,
			fsales_man_id,
			fsales_man,
			fsales_man_dept,
			fsettle_cycle,
			fattention,
			fcreate_time,
			fcreator,
			faudit_time,
			fsimple_name
        ) VALUES (
        	#{fid, jdbcType=INTEGER} ,
        	#{fnumber, jdbcType=VARCHAR} ,
        	#{fname, jdbcType=VARCHAR} ,
        	#{ftype, jdbcType=VARCHAR} ,
        	#{fregion, jdbcType=VARCHAR} ,
        	#{fuserRoleId, jdbcType=INTEGER} ,
        	#{fsalesManId, jdbcType=VARCHAR},
        	#{fsalesMan, jdbcType=VARCHAR},        	
			#{fsalesManDept, jdbcType=VARCHAR},
			#{fsettleCycle, jdbcType=VARCHAR},
			#{fattention, jdbcType=VARCHAR},
			#{fcreateTime, jdbcType=TIMESTAMP},
			#{fcreator, jdbcType=INTEGER},
			#{faudittime, jdbcType=TIMESTAMP},
			#{fsimplename, jdbcType=VARCHAR}
        )
    ]]>
    </insert>

    <update id="update" >
    <![CDATA[
         UPDATE cl_user_customer SET
         	fnumber = #{fnumber, jdbcType=VARCHAR},
            fname = #{fname, jdbcType=VARCHAR},
            ftype = #{ftype, jdbcType=VARCHAR},
            fregion =  #{fregion, jdbcType=VARCHAR},
            fsales_man_id =  #{fsalesManId, jdbcType=VARCHAR},
            fsales_man = #{fsalesMan, jdbcType=VARCHAR},
            fsales_man_dept =  #{fsalesManDept, jdbcType=VARCHAR},
	        fsettle_cycle = #{fsettleCycle, jdbcType=VARCHAR},
	        fattention =  #{fattention, jdbcType=VARCHAR},
	        faudit_time = #{faudittime, jdbcType=TIMESTAMP},
	        fsimple_name=#{fsimplename, jdbcType=VARCHAR}
        WHERE 
	        fid = #{fid} 
    ]]>
    </update>

    <delete id="delete">
    <![CDATA[
        DELETE FROM cl_user_customer WHERE
        fid = #{fid} 
    ]]>
    </delete>
    
    <select id="getById" resultMap="CL_UserCustomerMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_customer 
	        WHERE 
		        fid = #{fid} 
	    ]]>
    </select>
    
     <select id="getByUrid" resultMap="CL_UserCustomerMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_customer 
	        WHERE 
		        fuser_role_id = #{urid}
	    ]]>
    </select>
    
	<sql id="findWhere">
	    <where>
		   	<if test="@Ognl@isNotEmpty(fname)">
		   	  And (uc.fname LIKE CONCAT('%',#{fname},'%') OR uc.fsimple_name LIKE CONCAT('%',#{fname},'%') )
			</if>
			<if test="@Ognl@isNotEmpty(fuserName)">
		   	  And ur.vmi_user_name LIKE CONCAT('%',#{fuserName},'%')
			</if>
			<if test="@Ognl@isNotEmpty(fsalesMan)">
		   	  And uc.fsales_man LIKE CONCAT('%',#{fsalesMan},'%')
			</if>
			<if test="@Ognl@isNotEmpty(fsalesManDept)">
		   	  And uc.fsales_man_dept LIKE CONCAT('%',#{fsalesManDept},'%')
			</if>
			<if test="@Ognl@isNotEmpty(fcreateTimeBegin)">
		   		AND DATE_FORMAT(uc.fcreate_time ,'%Y-%m-%d') >= DATE_FORMAT(#{fcreateTimeBegin},'%Y-%m-%d')
		   	</if>
		   	<if test="@Ognl@isNotEmpty(fcreateTimeEnd)">
		   		AND DATE_FORMAT(uc.fcreate_time ,'%Y-%m-%d') &lt;= DATE_FORMAT(#{fcreateTimeEnd},'%Y-%m-%d')
		   	</if>
	    </where>
	</sql>

	<select id="find" resultMap="CL_UserCustomerMap">
	    SELECT <include refid="columns2"/> FROM cl_user_customer uc
	    LEFT JOIN cl_user_role ur ON uc.fuser_role_id = ur.id
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>	
	 
    <select id="findPageCount" resultType="long">
         SELECT count(1) FROM cl_user_customer uc
    	 LEFT JOIN cl_user_role ur ON uc.fuser_role_id = ur.id
        <include refid="findWhere"/>    
    </select>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <select id="findPage" resultMap="CL_UserCustomerMap">
    	SELECT <include refid="columns2"/> FROM cl_user_customer uc
    	LEFT JOIN cl_user_role ur ON uc.fuser_role_id = ur.id
		<include refid="findWhere"/>
		ORDER BY uc.fcreate_time DESC 
    </select>
    
    <select id="getMaxId" resultType="int">
  		SELECT MAX(fid) FROM cl_user_customer
    </select>
    
</mapper>

