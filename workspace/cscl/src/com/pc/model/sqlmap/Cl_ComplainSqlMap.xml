<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_Complain">

    <resultMap id="CL_ComplainMap" type="com.pc.model.CL_Complain">
        <result property="fid" column="fid"/>
        <result property="forderId" column="forderId"/>
        <result property="fcomplainUserName" column="fcomplainUserName"/>
        <result property="fcomplainType" column="fcomplainType"/>
        <result property="fcomplainContent" column="fcomplainContent"/>
        <result property="fcomplainCommunicateContent" column="fcomplainCommunicateContent"/>
        <result property="fdriverFineAmount" column="fdriverFineAmount"/>
        <result property="fdriverAccountDisable" column="fdriverAccountDisable"/>
        <result property="fdriverAccountDisableStart" column="fdriverAccountDisableStart"/>
        <result property="fdriverAccountDisableEnd" column="fdriverAccountDisableEnd"/>
        <result property="fdriverFreezeDisable" column="fdriverFreezeDisable"/>
        <result property="fdriverFreezeDisableStart" column="fdriverFreezeDisableStart"/>
        <result property="fdriverFreezeDisableEnd" column="fdriverFreezeDisableEnd"/>      
        <result property="fdriverRewardAmount" column="fdriverRewardAmount"/>        
        <result property="fdriverRemark" column="fdriverRemark"/>
        <result property="fshipperFineAmount" column="fshipperFineAmount"/>
        <result property="fshipperRewardCouponsAmount" column="fshipperRewardCouponsAmount"/>
        <result property="fshipperRewardCouponsDollars" column="fshipperRewardCouponsDollars"/>
        <result property="fshipperRewardCouponsStart" column="fshipperRewardCouponsStart"/>
        <result property="fshipperRewardCouponsEnd" column="fshipperRewardCouponsEnd"/>
        <result property="fshipperRemark" column="fshipperRemark"/>
        <result property="fcreateTime" column="fcreateTime"/>
        <result property="fcreator" column="fcreator"/>    
        <result property="fisdeal" column="fisdeal"/>        
        <result property="fdealMan" column="fdealMan"/>        
        <result property="fdealTime" column="fdealTime"/>        
        <result property="fremark" column="fremark"/>        
    </resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[
       cc. fid,cc.forderId,cc.fcomplainUserName,cc.fcomplainType,cc.fcomplainContent,cc.fcomplainCommunicateContent,cc.fdriverFineAmount,cc.fdriverAccountDisable,cc.fdriverAccountDisableStart,cc.fdriverAccountDisableEnd,
       cc.fdriverFreezeDisable,cc.fdriverFreezeDisableStart,cc.fdriverFreezeDisableEnd,cc.fdriverRewardAmount,cc.fdriverRemark,cc.fshipperFineAmount,cc.fshipperRewardCouponsAmount,cc.fshipperRewardCouponsDollars,
        cc.fshipperRewardCouponsStart,cc.fshipperRewardCouponsEnd,cc.fshipperRemark,cc.fcreateTime,cc.fcreator,cc.fisdeal,cc.fdealMan,cc.fdealTime,cc.fremark,ur1.vmi_user_name as fcreate_name,ur2.vmi_user_name as fdeal_name,
        o.number orderNumber
	    ]]>
	</sql>
	
    <insert id="insert"  useGeneratedKeys="true" keyProperty="fid">
    <![CDATA[
        INSERT INTO cl_user_complain(
			forderId,                    
			fcomplainUserName,           
			fcomplainType,               
			fcomplainContent,            
			fcomplainCommunicateContent,                
			fdriverFineAmount,           
			fdriverAccountDisable,       
			fdriverAccountDisableStart,  
			fdriverAccountDisableEnd,    
			fdriverFreezeDisable,        
			fdriverFreezeDisableStart,   
			fdriverFreezeDisableEnd,     
			fdriverRewardAmount,         
			fdriverRemark,                        
			fshipperFineAmount,          
			fshipperRewardCouponsAmount, 
			fshipperRewardCouponsDollars,
			fshipperRewardCouponsStart,  
			fshipperRewardCouponsEnd,    
			fshipperRemark,
			fcreateTime,    
			fcreator,
			fisdeal, 
			fdealMan,
			fdealTime,
			fremark
        ) VALUES (
			#{forderId,jdbcType=INTEGER},                   
			#{fcomplainUserName,jdbcType=VARCHAR},           
			#{fcomplainType,jdbcType=INTEGER},               
			#{fcomplainContent,jdbcType=VARCHAR},            
			#{fcomplainCommunicateContent,jdbcType=VARCHAR}, 
			#{fdriverFineAmount,jdbcType=DECIMAL},           
			#{fdriverAccountDisable,jdbcType=BIT},       
			#{fdriverAccountDisableStart,jdbcType=TIMESTAMP},  
			#{fdriverAccountDisableEnd,jdbcType=TIMESTAMP},    
			#{fdriverFreezeDisable,jdbcType=BIT},        
			#{fdriverFreezeDisableStart,jdbcType=TIMESTAMP},   
			#{fdriverFreezeDisableEnd,jdbcType=TIMESTAMP},     
			#{fdriverRewardAmount,jdbcType=DECIMAL},           
			#{fdriverRemark,jdbcType=VARCHAR},               
			#{fshipperFineAmount,jdbcType=DECIMAL},            
			#{fshipperRewardCouponsAmount,jdbcType=DECIMAL}, 
			#{fshipperRewardCouponsDollars,jdbcType=DECIMAL}, 
			#{fshipperRewardCouponsStart,jdbcType=TIMESTAMP},  
			#{fshipperRewardCouponsEnd,jdbcType=TIMESTAMP},    
			#{fshipperRemark,jdbcType=VARCHAR},
			#{fcreateTime,jdbcType=TIMESTAMP},
			#{fcreator,jdbcType=INTEGER},
		 	#{fisdeal,jdbcType=INTEGER}, 
			#{fdealMan,jdbcType=INTEGER},
			#{fdealTime,jdbcType=TIMESTAMP},
			#{fremark,jdbcType=VARCHAR}
        )
    ]]>
    </insert>

    <update id="update" >
    <![CDATA[
         UPDATE cl_user_complain SET
			fid=#{fid,jdbcType=INTEGER},
			forderId=#{forderId,jdbcType=INTEGER},
			fcomplainUserName=#{fcomplainUserName,jdbcType=VARCHAR},
			fcomplainType=#{fcomplainType,jdbcType=INTEGER},
			fcomplainContent=#{fcomplainContent,jdbcType=VARCHAR},
			fcomplainCommunicateContent=#{fcomplainCommunicateContent,jdbcType=VARCHAR},
			fdriverFineAmount=#{fdriverFineAmount,jdbcType=DECIMAL},
			fdriverAccountDisable=#{fdriverAccountDisable,jdbcType=BIT},
			fdriverAccountDisableStart=#{fdriverAccountDisableStart,jdbcType=TIMESTAMP},
			fdriverAccountDisableEnd=#{fdriverAccountDisableEnd,jdbcType=TIMESTAMP},
			fdriverFreezeDisable=#{fdriverFreezeDisable,jdbcType=BIT},
			fdriverFreezeDisableStart=#{fdriverFreezeDisableStart,jdbcType=TIMESTAMP},
			fdriverFreezeDisableEnd=#{fdriverFreezeDisableEnd,jdbcType=TIMESTAMP},
			fdriverRewardAmount=#{fdriverRewardAmount,jdbcType=DECIMAL},
			fdriverRemark=#{fdriverRemark,jdbcType=VARCHAR},
			fshipperFineAmount=#{fshipperFineAmount,jdbcType=DECIMAL},
			fshipperRewardCouponsAmount=#{fshipperRewardCouponsAmount,jdbcType=DECIMAL},
			fshipperRewardCouponsDollars=#{fshipperRewardCouponsDollars,jdbcType=DECIMAL},
			fshipperRewardCouponsStart=#{fshipperRewardCouponsStart,jdbcType=TIMESTAMP},
			fshipperRewardCouponsEnd=#{fshipperRewardCouponsEnd,jdbcType=TIMESTAMP},
			fshipperRemark=#{fshipperRemark,jdbcType=VARCHAR},
			fcreateTime=#{fcreateTime,jdbcType=TIMESTAMP},
			fcreator=#{fcreator,jdbcType=INTEGER},
			fisdeal=#{fisdeal,jdbcType=INTEGER},
			fdealMan=#{fdealMan,jdbcType=INTEGER},
			fdealTime=#{fdealTime,jdbcType=TIMESTAMP},
			fremark=#{fremark,jdbcType=VARCHAR}
			
			WHERE fid = #{fid} 
    ]]>
    </update>

    <update id="updateAmount" >
    <![CDATA[
        UPDATE cl_user_complain SET
			fdriverFineAmount=#{fdriverFineAmount,jdbcType=DECIMAL},
			fdriverRewardAmount=#{fdriverRewardAmount,jdbcType=DECIMAL},
			fshipperFineAmount=#{fshipperFineAmount,jdbcType=DECIMAL}
        WHERE 
	        fid = #{fid} 
    ]]>
    </update>
    
    <delete id="delete">
    <![CDATA[
        DELETE FROM cl_user_complain WHERE
        fid = #{fid} 
    ]]>
    </delete>
    
    <select id="getById" resultMap="CL_ComplainMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_complain cc
	        left join cl_user_role ur1 on ur1.id=cc.fcreator
	        left join cl_user_role ur2 on ur2.id=cc.fdealMan
	        left join cl_order o on o.id = cc.forderId
	        WHERE 
		        fid = #{fid} 
	    ]]>
    </select>
    
	<sql id="findWhere">
	    <where>
		   	<if test="@Ognl@isNotEmpty(forderId) and forderId!=0">
		   	  	And cc.forderId = #{forderId}
			</if>
			<if test="@Ognl@isNotEmpty(sortColumns)">
				and ${sortColumns}
			</if>
			<if test="@Ognl@isNotEmpty(fisdeal)">
				and cc.fisdeal = #{fisdeal}
			</if>
	    </where>
	</sql>
	
	<sql id="findWhere1">
	    <where>
	       <if test="true">
	        	co.user_role_id IS NOT NULL
	       </if>
		   	<if test="@Ognl@isNotEmpty(forderId) and forderId!=0">
		   	  	And co.id = #{forderId}
			</if>
	    </where>
	</sql>
	
	<select id="find" resultMap="CL_ComplainMap">
	    SELECT <include refid="columns"/> FROM cl_user_complain cc
	        left join cl_user_role ur1 on ur1.id=cc.fcreator
	        left join cl_user_role ur2 on ur2.id=cc.fdealMan
	        left join cl_order o on o.id = cc.forderId
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>	
	 
    <select id="findPageCount" resultType="long">
        SELECT count(cc.fid) FROM cl_user_complain cc 
        <include refid="findWhere"/>    
    </select>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <select id="findPage" resultMap="CL_ComplainMap">
    	SELECT <include refid="columns"/> FROM cl_user_complain cc
	        left join cl_user_role ur1 on ur1.id=cc.fcreator
	        left join cl_user_role ur2 on ur2.id=cc.fdealMan
	        left join cl_order o on o.id = cc.forderId
		<include refid="findWhere"/>
		ORDER BY fcreateTime DESC 
    </select>
    
    <!--订单（带货主,司机的下拉框）-->
    <select id="getOrderDropdown" resultType="java.util.Map">
		SELECT co.id,co.number forderNum,ur.vmi_user_name fuserName, cc.driverName fdriverName,
		cc.fluckDriver,cc.fluckDriver,co.creator shipperId,co.user_role_id driverId
		FROM cl_order co JOIN cl_car cc ON cc.user_role_id = co.user_role_id 
		JOIN cl_user_role ur ON co.creator = ur.id
		<include refid="findWhere1"/>
    </select>
    
    <!--根据投诉头ID获得所有明细信息-->
    <select id="getEntrysByParentId" resultType="java.util.Map">
		SELECT ur.vmi_user_name fuserName,e.ftype,e.famount,e.fremark FROM cl_user_complain c
		JOIN cl_complain_entry e ON e.fparentid = c.fid
		JOIN cl_user_role ur ON ur.id = e.fuserid
		WHERE c.fid = #{fid}
    </select>
</mapper>

