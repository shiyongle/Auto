<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CL_UserVoucher">

    <resultMap id="CLUserVoucherMap" type="com.pc.model.CL_UserVoucher">
        <result property="fid" column="fid"/>
        <result property="fcreator" column="fcreator"/>
        <result property="fcreatorTime" column="fcreatorTime"/>
        <result property="number" column="number"/>
        <result property="fstatus" column="fstatus"/>
        <result property="fmoeny" column="fmoeny"/>
        <result property="fisover" column="fisover"/>
        <result property="fbankName" column="fbankName"/>
        <result property="ftype" column="ftype"/>
         <result property="fdata" column="fdata"/>
         <result property="fpayorRecharge" column="fpayorRecharge"/>
         <result property="forderNumber" column="forderNumber"/>
         
        
    </resultMap>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
	    <![CDATA[fid ,fcreator ,fcreatorTime, number,fstatus,fmoeny,fisover,fbankName,ftype,fdata,fpayorRecharge,forderNumber]]>
	</sql>
	
	
 <sql id="columns1">
	    <![CDATA[vou.fid ,vou.fcreator ,vou.fcreatorTime, vou.number,vou.fstatus,vou.fmoeny,vou.fisover,cur.vmi_user_phone vmiUserPhone,vou.fbankName,vou.ftype,vou.fdata,vou.fpayorRecharge,vou.forderNumber]]>
	</sql>
	
    <insert id="insert" useGeneratedKeys="true" keyProperty="fid" >
    <![CDATA[
        INSERT INTO cl_user_voucher (
        	 fid,fcreator,fcreatorTime,number,fstatus,fmoeny,fisover,fbankName,ftype,fdata,fpayorRecharge,forderNumber
        )VALUES(
        	#{fid, jdbcType=INTEGER} ,
        	#{fcreator, jdbcType=INTEGER} ,
        	#{fcreatorTime, jdbcType=TIMESTAMP} ,
        	#{number, jdbcType=VARCHAR} ,
        	#{fstatus, jdbcType=INTEGER} ,
        	#{fmoeny, jdbcType=DECIMAL} ,
        	#{fisover, jdbcType=INTEGER} ,
        	#{fbankName, jdbcType=VARCHAR} ,
        	#{ftype, jdbcType=INTEGER} ,
        	#{fdata, jdbcType=VARCHAR}, 
        	#{fpayorRecharge, jdbcType=INTEGER},
        	#{forderNumber, jdbcType=VARCHAR}
        	
        	
        	
        )
    ]]>
    </insert>

    <update id="update" >
    <![CDATA[
        UPDATE cl_user_voucher SET
	        fcreator = #{fcreator, jdbcType=INTEGER} ,
	        fcreatorTime = #{fcreatorTime, jdbcType=TIMESTAMP} ,
	        number=#{number, jdbcType=VARCHAR} ,
	        fstatus = #{fstatus, jdbcType=INTEGER} ,
	        fmoeny=#{fmoeny, jdbcType=DECIMAL} ,
	        fisover= #{fisover, jdbcType=INTEGER} ,
	        fbankName= #{fbankName, jdbcType=VARCHAR} ,
	        ftype=#{ftype, jdbcType=INTEGER} ,
	        fdata=#{fdata,jdbcType=VARCHAR},
	        fpayorRecharge=#{fpayorRecharge, jdbcType=INTEGER},
	        forderNumber=#{forderNumber, jdbcType=VARCHAR}
        WHERE 
	        fid = #{fid, jdbcType=INTEGER} 
    ]]>
    </update>
    
    
      <update id="updateByStatus" >
    <![CDATA[
        UPDATE cl_user_voucher SET
	        fstatus = #{fstatus, jdbcType=INTEGER} ,
        WHERE 
	        fid = #{fid, jdbcType=INTEGER}  AND   fcreator = #{fcreator, jdbcType=INTEGER} 
    ]]>
    </update>
    
    
      <!--  过期 -->
    <update id="updateVouCherDetail">
        update cl_user_voucher  set fisover =1 WHERE
        fid IN 
		<foreach item="item" collection="ids" open="("
				separator="," close=")">
				#{item}
		</foreach>
    </update>
    
    
          <!-- 校验通过 -->
    <update id="updateVouCherStatusDetail">
        update cl_user_voucher  set fstatus =1 WHERE
        fid IN 
		<foreach item="item" collection="ids" open="("
				separator="," close=")">
				#{item}
		</foreach>
    </update>

    <delete id="delete">
    <![CDATA[
        DELETE FROM cl_user_voucher WHERE  fid = #{fid} and fcreator=#{fcreator}
    ]]>
    </delete>
    
    
      <select id="getByForderNumber" resultMap="CLUserVoucherMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_voucher WHERE  forderNumber=#{forderNumber} and fcreator=#{fcreator}  
	    ]]>
    </select>
    
    
    <select id="getById" resultMap="CLUserVoucherMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_voucher WHERE  fid = #{fid}   
	    ]]>
    </select>
    
     <select id="getByStatusInTast" resultMap="CLUserVoucherMap">
	    SELECT <include refid="columns1"/>
	    <![CDATA[
	        FROM cl_user_voucher vou 
	        LEFT JOIN cl_user_role cur on vou.fcreator = cur.id
	        WHERE  vou.fstatus!=1    AND vou.fisover=0 AND vou.ftype!=3 and vou.ftype!=0
	    ]]>
    </select>
    
       <select id="getByIdAndFcreator" resultMap="CLUserVoucherMap">
	    SELECT <include refid="columns"/>
	    <![CDATA[
	        FROM cl_user_voucher WHERE  fid = #{fid}   and fcreator=#{fcreator}
	    ]]>
    </select>
    
    <sql id="findWhere">
	    <where>
		   	<if test="@Ognl@isNotEmpty(fid)">
			    AND fid = #{fid}
			</if>
            <if test="@Ognl@isNotEmpty(fcreator)">
                AND fcreator = #{fcreator}
            </if>
		  
	    </where>
	</sql>
    
    <!-- 求满足条件的记录数 --> 
   	<select id="findPageCount" resultType="long">
        SELECT count(*) FROM cl_user_voucher <include refid="findWhere"/>    
    </select>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <select id="findPage" resultMap="CLUserVoucherMap">
    	SELECT <include refid="columns"/> FROM cl_user_voucher 
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>

	<!-- 查询记录树 -->
	<select id="find" resultMap="CLUserVoucherMap">
	    SELECT <include refid="columns"/> FROM cl_user_voucher 
		<include refid="findWhere"/>
		<if test="@Ognl@isNotEmpty(sortColumns)">
			ORDER BY ${sortColumns}
		</if>
    </select>
</mapper>

