<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title></title>
<link rel="stylesheet" href="css/styles.css" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>

<link type="text/css" rel="stylesheet" href="css/plug.css"/>
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>


<link href="css/smohan.face.css" type="text/css" rel="stylesheet"> 
<script type="text/javascript" src="js/smohan.face.js" charset="utf-8"></script>



<!--[if IE 6]>
<script type="text/javascript" src="js/iepngfix_tilebg.js"></script>
<![endif]-->
<script type="text/javascript">
function position(elem,l,t){
	var isIE6 = !-[1,] && !window.XMLHttpRequest;
	if(isIE6){
		var style = elem.style,
		dom  = '(document.documentElement)',
        left = l - document.documentElement.scrollLeft,
        top  = t - document.documentElement.scrollTop;
		style.position = 'absolute';
		style.removeExpression('left');
		style.removeExpression('top');
		style.setExpression('left', 'eval(' + dom + '.scrollLeft + ' + left + ') + "px"');
		style.setExpression('top', 'eval(' + dom + '.scrollTop + ' + top + ') + "px"');
	}else{
		elem.style.position = 'fixed';
	}
}
$(function(){
	$("#updown").css("top",window.screen.availHeight/2-100+"px");
	$(window).scroll(function() {		
		if($(window).scrollTop() >= 100){
			$('#updown').fadeIn(300); 
		}else{    
			$('#updown').fadeOut(300);    
		}  
	});
	$('#updown .up').click(function(){$('html,body').animate({scrollTop: '0px'}, 800);});
	$('#updown .down').click(function(){$('html,body').animate({scrollTop: document.body.clientHeight+'px'}, 800);});
});

$(function (){
	$("a.face").smohanfacebox({
		Event : "click",	//触发事件	
		divid : "Smohan_FaceBox", //外层DIV ID
		textid : "Smohan_text" //文本框 ID
	});
	
});
function showFaceTest(date){
	var id = $(date).prev("input");
	var faceimg = '';
    for(i=0;i<60;i++){  //通过循环创建60个表情，可扩展
	 faceimg+='<li><a onclick="giveTextFace(this)"><img src="images/face/'+(i+1)+'.gif" face="<emt>'+(i+1)+'</emt>"/></a></li>';
	 };
	$("#"+id.val()).prepend("<div id='SmohanFaceBox'><span class='Corner'></span><div class='Content'><h3><span>常用表情</span><a onclick='closeface()' class='close' title='关闭'></a></h3><ul>"+faceimg+"</ul></div></div>");
	
}
function closeface(){
	
}
function scscms_alert(msg,sign,ok,can){
	var c_=false;//是否已经关闭窗口，解决自动关闭与手动关闭冲突
	sign=sign||"";
	var s="<div id='mask_layer'></div><div id='scs_alert'><div id='alert_top'></div><div id='alert_bg'><table width='260' align='center' border='0' cellspacing='0' cellpadding='1'><tr>";
	if (sign!="")s+="<td width='45'><div id='inco_"+sign+"'></div></td>";
	s+="<td id='alert_txt'>"+msg+"</td></tr></table>";
	if (sign=="confirm"){
		s+="<a href='javascript:void(0)' id='confirm_ok'>确 定</a><a href='javascript:void(0)' id='confirm_cancel'>取 消</a>";
	}else{
		s+="<a href='javascript:void(0)' id='alert_ok'>确 定</a>"
	}
	s+="</div><div id='alert_foot'></div></div>";
	$("body").append(s);
	$("#scs_alert").css("margin-top",-($("#scs_alert").height()/2)+"px"); //使其垂直居中
	$("#scs_alert").focus(); //获取焦点，以防回车后无法触发函数
	position(document.getElementById('mask_layer'),0,0);
	position(document.getElementById('scs_alert'),$(window).width()/2,$(window).height()/2);
	if (typeof can == "number"){
	//定时关闭提示
		setTimeout(function(){
			close_info();
		},can*1000);
	}
	function close_info(){
	//关闭提示窗口
		if(!c_){
		$("#mask_layer").fadeOut("fast",function(){
			$("#scs_alert").remove();
			$(this).remove();
		});
		c_=true;
		}
	}
	$("#alert_ok").click(function(){
		close_info();
		if(typeof(ok)=="function")ok();
	});
	$("#confirm_ok").click(function(){
		close_info();
		if(typeof(ok)=="function")ok();
	});
	$("#confirm_cancel").click(function(){
		close_info();
		if(typeof(can)=="function")can();
	});
	function modal_key(e){	
		e = e||event;
		close_info();
		var code = e.which||event.keyCode;
		if (code == 13 || code == 32){if(typeof(ok)=="function")ok()}
		if (code == 27){if(typeof(can)=="function")can()}		
	}
	//绑定回车与ESC键
	if (document.attachEvent)
		document.attachEvent("onkeydown", modal_key);
	else
		document.addEventListener("keydown", modal_key, true);
}
function answerFace(a){
	var strFace = '<div  class="hideFace" style="background-color:white;position:absolute;z-index:1000;padding: 9px;">' +
	  '<table border="0" cellspacing="0" cellpadding="0"><h3><span>常用表情</span><a class="closeFace" style="display:inline-block; width:16px; height:16px; background:url(images/facebg_1.png) -30px -120px; float:right; cursor:pointer;" title="关闭"></a></h3><tr>';
	for(var i=1; i<61; i++){
		strFace += '<td style="padding: 2px;border:1px solid #f8f8f8;" ><a href="javascript:void(0)"><img src="images/face/'+i+'.gif" face="<emt>'+i+'</emt>"/></a></td>';
		if( i % 12 == 0 ) strFace += '</tr><tr>';
	}
		strFace += '</tr></table></div>';
	$("#"+a.id).append(strFace);
	/**$(".hideFace").focus().blur(function(){
		$(".hideFace").hide();
	});**/
	$(".closeFace").click(function(){
		$(".hideFace").remove();
	});
	var c = $(".hideFace table td img");
	c.die().click(function(){
		 //$("#"+options.textid).focus();
		 //$("#"+options.textid).val($("#"+options.textid).val()+$(this).attr("face"));
		 $("#"+a.id).find("textarea").die().insertContent($(this).attr("face"));
		 $(".hideFace").remove();
		});	
	$.fn.extend({  
		insertContent : function(myValue, t) {  
			var $t = $(this)[0];  
			if (document.selection) {  
				this.focus();  
				var sel = document.selection.createRange();  
				sel.text = myValue;  
				this.focus();  
				sel.moveStart('character', -l);  
				var wee = sel.text.length;  
				if (arguments.length == 2) {  
				var l = $t.value.length;  
				sel.moveEnd("character", wee + t);  
				t <= 0 ? sel.moveStart("character", wee - 2 * t	- myValue.length) : sel.moveStart("character", wee - t - myValue.length);  
				sel.select();  
				}  
			} else if ($t.selectionStart || $t.selectionStart == '0') {  
				var startPos = $t.selectionStart;  
				var endPos = $t.selectionEnd;  
				var scrollTop = $t.scrollTop;  
				$t.value = $t.value.substring(0, startPos) + myValue + $t.value.substring(endPos,$t.value.length);  
				this.focus();  
				$t.selectionStart = startPos + myValue.length;  
				$t.selectionEnd = startPos + myValue.length;  
				$t.scrollTop = scrollTop;  
				if (arguments.length == 2) { 
					$t.setSelectionRange(startPos - t,$t.selectionEnd + t);  
					this.focus(); 
				}  
			} else {                              
				this.value += myValue;                              
				this.focus();  
			}  
		}  
	});
}
</script>

<script>
	function answer(data){
		if($(data).html()=="回复"){
			//var name = $(data).parent().prevAll(".name");
			var conacat = $(data).parent().prevAll(".name").nextAll("p");
			var fid = $(data).prev("input");
			var a = fid.val();
			var b = a.substring(0,a.length-1);
			var test = $("#"+b).find("textarea");
			var name = $("#"+fid.val()+"1").html();
			var conacat = $("#"+fid.val()+"2").html();
			if(conacat.length>20){
				conacat = conacat.substring(0,20);
			}
			var date = $("#"+fid.val()+"3").html(); 
			test.focus();
			var answerName = $(".answerName");
			answerName.html("回复"+name+":"+conacat);
			 
		}
	}
	function resetAll(data){
		var answerName = $(".answerName");
		var test = $("textarea");
		answerName.html("");
		test.val("");
	}
	
	function sendNote(data){
		var d = document.getElementById('topAnswerNoWay');
		if(d.value==""){
			scscms_alert("评论不能为空(两秒后自动关闭)","warn","",2);
			return;
		}
		$.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"saveNoteForBoard.do",
			type:'post',
			contentType: "application/x-www-form-urlencoded; charset=utf-8", 
			data:{
				"fcontent":d.value,
				
			}, success : function(data) {
				location.reload();
				d.value = "";
			}
		});
		
	}
	function testFF(){
		var faces = $('#Smohan_text').val();
		
		for(i=0;i<60;i++){
			
			var re = new RegExp("<emt>"+(i+1)+"</emt>",'g');
			
			faces=faces.replace(re,'<img src="images/face/'+(i+1)+'.gif">');
		}
		
		if(faces==""){
			scscms_alert("评论不能为空(两秒后自动关闭)","warn","",2);
			return;
		}
		$.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"saveNoteForBoard.do",
			type:'post',
			contentType: "application/x-www-form-urlencoded; charset=utf-8", 
			data:{
				"fcontent":faces,
				
			}, success : function(data) {
				location.reload();
				faces = "";
			}
		});
		
	
	}
	function sendAnswer(daa){
		var test = $(daa).parent().parent().find("textarea");
		var faces = test.val();
		for(i=0;i<60;i++){
			var re = new RegExp("<emt>"+(i+1)+"</emt>",'g');
			
			faces=faces.replace(re,'<img src="images/face/'+(i+1)+'.gif">');
		}
		if(test.val()==""){
			scscms_alert("回复不能为空！(两秒后自动关闭)","warn","",2);
			return;
		}
		var id = $(daa).prev("input");
		var answerName = $(".answerName");
		var fprenoteMsg = answerName.html();
		if(fprenoteMsg==""){
			var medId = id.val();
			var name = $("#"+medId+"1").html();
			var conacat = $("#"+medId+"2").html();
			if(conacat.length>100){
				conacat = conacat.substring(0,100);
			}
			fprenoteMsg = "回复"+name+":"+conacat;
		}
			$.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"saveNoteAnswerForBoard.do",
				type:'post',
				contentType: "application/x-www-form-urlencoded; charset=utf-8", 
				data:{
					"answerMsg":faces,
					"answerPerson":fprenoteMsg,
					"fid":id.val()
				},success:function(data){
					var currentDT = new Date();  
					var y,m,date,hs,ms,ss,theDateStr;  
					y = currentDT.getFullYear(); //四位整数表示的年份  
					m = currentDT.getMonth(); //月  
					date = currentDT.getDate(); //日  
					hs = currentDT.getHours(); //时  
					ms = currentDT.getMinutes(); //分  
					ss = currentDT.getSeconds(); //秒
					var theDateStr = y+"-"+m+"-"+date+" "+hs+":"+ms+":"+ss;
					$.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"getNowUserName.do",
						type : "post",
						dataType:'json', 
						success:function(bc){
							console.log(faces);
							var addForAnswer = '<div class="name">'+bc.data.nameForAnswer+'</div>'+fprenoteMsg+'<p><m>'+faces+'<div class="answerDate">'+theDateStr+'</div><br><div class="answer"></div></p>';
							$(daa).parent().prevAll(".service-info-text").append(addForAnswer);
							resetAll(this);
						}
						
					});
					scscms_alert("回复成功(两秒后自动关闭)","ok","",2);
					
				}
			});
		
	}
</script>
<script>
	$(document).ready(function(){
		$.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"gainNotesBase.do",
			async: false, 
		     type: 'post',
		     dataType : "json",
		      success : function(data) {
		    	 for(var i=0;i<data.data.length;i++){
		    		 var tableForWeb = '<li id="'+data.data[i].fid+'"><h2><m id="'+data.data[i].fid+'1">'+data.data[i].fuserName+'</m>:<a title="" ><m id="'+data.data[i].fid+'2">'+data.data[i].fcontent+'</m><div class="answerDate" id="'+data.data[i].fid+'3">'+data.data[i].fdate+'</div></a></h2><div>'
		            +'<div class="service-content" id="service-contentID">'
		            +'<div class="service-info-text">';
		    		 $.ajax({url:parent.location.pathname.substring(0,parent.location.pathname.lastIndexOf('/')+1)+"findAnswerByTime.do",
		    			 data:{
		    				 'fid':data.data[i].fid
		    			 },
		    			 async: false, 
		    			 type: 'post',
		    			 contentType: "application/x-www-form-urlencoded; charset=utf-8", 
		    		     dataType : "json",
		    		     success : function(d) {
		    		    	 if(d.total>0){
			    		    	 for(var j=0;j<d.total;j++){
			    		    		 var medId = data.data[i].fid+j;
			    		    		 tableForWeb = tableForWeb +'<div id="border-bottomtest"><div class="name" id="'+medId+'1">'+d.data[j].fuserName+'</div>'+d.data[j].fprenoteMsg+'<p><m id="'+medId+'2">'+d.data[j].fcontent+'<div class="answerDate" id="'+medId+'3">'+d.data[j].fdate+'</div><br><div class="answer"><input type="hidden" value="'+medId+'"/><a  onclick="answer(this)">回复</a></div></p></div>';
			    		    	 }
		    		    	 }
		    		    	 tableForWeb = tableForWeb +'</div><div class="answerName"></div><textarea ></textarea><a onclick="answerFace(this)" value="bbb" class="answerFace" title="表情" id="'+data.data[i].fid+'"></a><div class="answer" style="width:590px !important"><a onclick="resetAll(this)">清空</a><input type="hidden" value="'+data.data[i].fid+'"/><a onclick="sendAnswer(this)">发送</a></div></div></div></li>';
		    		    	 
		    		     }
		    		 });
		    		 $('.services-list').append(tableForWeb);
		    	 }
		     }
		});
	});
</script>
<link rel="stylesheet" href="css/animate.min.css" />
</head>
<body>
<div class="main">
  <div class="main_c">
 <link href="css/online.css" rel="stylesheet" type="text/css" />
<div id="onService_panel">
<div class="onService_panel_s">
<div class="online_boxs">
<div class="boxs_t"><span class="boxs_t_l"></span><span class="boxs_t_m"></span><span class="boxs_t_r"></span></div>
  <div class="boxs_m_l">
    <div class="boxs_m_r">
      <div class="box_m_m">
        <div id="onlineList">
          <em class="online_close" id="onlineClose" title="关闭"></em>
          <div class="online_open  " id="onlineOpen"></div>
          <div id="online_tel_icon" class="online_icon">
            <span class="pic"><img src="images/online_weixin.jpg" /></span>
            <span class="name">微信二维码</span>
          </div>
          <div id="online_qq_icon" class="online_icon">
            <span class="pic"><img src="images/online_qq.png" /></span>
            <span class="name">在线客服</span>
          </div>
          <div id="online_message_icon" class="online_icon">
            <span class="pic"><img src="images/online_message.png" /></span>
            <span class="name">在线留言</span>
          </div>
           <div id="online_address_icon" class="online_icon">
            <span class="pic"><a href="http://map.baidu.com/?newmap=1&s=inf%26uid%3Df5e3bcaecc8df0c25e17c369%26wd%3D%E6%B8%A9%E5%B7%9E%E4%B8%9C%E7%BB%8F%E5%8C%85%E8%A3%85%26all%3D1%26c%3D178&from=alamap&tpl=map_singlepoint/" target="_blank"><img src="images/online_address.png" /></a></span>
            <span class="name">公司地址</span>
          </div>
                    <div id="onlineTelTab" class="online_tab">
            <div class="online_boxs">
            <div class="boxs_t"><span class="boxs_t_l"></span><span class="boxs_t_m"></span><span class="boxs_t_r"></span></div>
              <div class="boxs_m_l">
                <div class="boxs_m_r">
                  <div class="box_m_m">
                    <div id="onlineTel" class="online_tab_c">
                    <small class="sanjiao"></small><small class="tab_close"></small>
                      <dl>
						<img src="images/qrcode.png" style="max-height:200px;max-width:220px;overflow:hidden"/>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>
            <div class="boxs_b"><span class="boxs_b_l"></span><span class="boxs_b_m"></span><span class="boxs_b_r"></span></div>
            </div>
          </div>
          <div id="onlineQQTab" class="online_tab">
            <div class="online_boxs">
            <div class="boxs_t"><span class="boxs_t_l"></span><span class="boxs_t_m"></span><span class="boxs_t_r"></span></div>
              <div class="boxs_m_l">
                <div class="boxs_m_r">
                  <div class="box_m_m">
                    <div id="onlineQQ" class="online_tab_c">
                    <small class="sanjiao"></small><small class="tab_close"></small>
                    <dl>
                       <dt>QQ</dt>
                            <dd>
                                <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=1718733793&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:1234567:51"/></a>
                                </dd>
                              </dl>
                    </div>
                  </div>
                </div>
              </div>
            <div class="boxs_b"><span class="boxs_b_l"></span><span class="boxs_b_m"></span><span class="boxs_b_r"></span></div>
            </div>
          </div>
          <div id="onlineMessageTab" class="online_tab">
            <div class="online_boxs">
            <div class="boxs_t"><span class="boxs_t_l"></span><span class="boxs_t_m"></span><span class="boxs_t_r"></span></div>
              <div class="boxs_m_l">
                <div class="boxs_m_r">
                  <div class="box_m_m">
                    <div id="onlineMessage" class="online_tab_c">
                    <small class="sanjiao"></small><small class="tab_close"></small>
                      <dl>
                        <div id="Smohan_FaceBox">
							<textarea name="text" id="Smohan_text" class="smohan_text"></textarea>
						   <p>
						   <a href="javascript:void(0)" class="face" title="表情"></a>
						   </p>
						   <br>
						   <button class="button" id="Smohan_Showface" onclick="testFF()">评论</button>
						   <br><br><br>
						</div>
                      </dl>
                    </div>
                  </div>
                </div>
              </div>
            <div class="boxs_b"><span class="boxs_b_l"></span><span class="boxs_b_m"></span><span class="boxs_b_r"></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<div class="boxs_b"><span class="boxs_b_l"></span><span class="boxs_b_m"></span><span class="boxs_b_r"></span></div>
</div>
</div>
</div>
<script language="javascript" src="js/online.js"></script>
   
</div>
</div>


			<div class="site-content services">
				<div class="wrapper">
				<!--  <div class="firstAnswer">
		<textarea id="topAnswerNoWay" class="topAnswer"></textarea></div>
		<div class="topAnswerReturn">
			<span onclick="sendNote()">发送</span>
			</div>   -->
					<ul class="services-list" id="testForload">

					</ul>
				</div>
			</div>
			<div class="inner clearfix">
				<section id="main-content">

				<div class="text-center">
					<ul id="pagination-demo-v1_1" class="pagination-sm"></ul>

				</div>

				</section>
			</div>
			
<div id="updown"><span class="up"></span></div>
</body>

<script src="js/jquery-ui-1.8.16.custom.min.js"></script>
<script src="js/scripts.js"></script>

</html>
